# 阶段上下文模板

用于 `.planning/phases/XX-name/{phase}-CONTEXT.md` 的模板 — 捕获阶段的实施决策。

**目的：** 记录下游代理需要的决策。研究者用它来知道需要调查什么。规划者用它来知道哪些选择已锁定、哪些仍灵活。

**核心原则：** 类别不是预定义的。它们从该阶段实际讨论的内容中产生。CLI 阶段有 CLI 相关的章节，UI 阶段有 UI 相关的章节。

**下游使用者：**
- `gsd-phase-researcher` — 读取决策以聚焦研究（例如，"卡片布局" → 研究卡片组件模式）
- `gsd-planner` — 读取决策以创建具体任务（例如，"无限滚动" → 任务包含虚拟化）

---

## 文件模板

```markdown
# 阶段 [X]: [名称] - 上下文

**收集时间：** [日期]
**状态：** 准备好进行规划

<domain>
## 阶段边界

[清晰说明该阶段交付的内容 — 范围锚点。来自 ROADMAP.md，是固定的。讨论阐明此边界内的实现方式。]

</domain>

<decisions>
## 实施决策

### [讨论过的领域 1]
- [做出的具体决策]
- [如适用，另一个决策]

### [讨论过的领域 2]
- [做出的具体决策]

### [讨论过的领域 3]
- [做出的具体决策]

### Claude 的裁量权
[用户明确说"你决定"的领域 — Claude 在规划/实施期间在此处有灵活性]

</decisions>

<specifics>
## 具体想法

[讨论中提到的任何具体引用、示例或"我想要像 X 这样的"时刻。产品引用、具体行为、交互模式。]

[如果没有："无具体要求 — 开放采用标准方法"]

</specifics>

<deferred>
## 延迟的想法

[讨论中提出但属于其他阶段的想法。在此捕获以免丢失，但明确超出该阶段的范围。]

[如果没有："无 — 讨论保持在阶段范围内"]

</deferred>

---

*阶段：XX-name*
*上下文收集时间：[日期]*
```

<good_examples>

**示例 1：视觉功能（帖子信息流）**

```markdown
# 阶段 3：帖子信息流 - 上下文

**收集时间：** 2025-01-20
**状态：** 准备好进行规划

<domain>
## 阶段边界

在可滚动信息流中显示关注用户的帖子。用户可以查看帖子并查看互动计数。创建帖子和互动是独立的阶段。

</domain>

<decisions>
## 实施决策

### 布局风格
- 基于卡片的布局，而非时间线或列表
- 每张卡片显示：作者头像、姓名、时间戳、完整帖子内容、互动计数
- 卡片有微妙的阴影、圆角 — 现代感

### 加载行为
- 无限滚动，而非分页
- 移动端支持下拉刷新
- 顶部显示新帖子指示器（"3 条新帖子"），而非自动插入

### 空状态
- 友好的插图 + "关注用户以查看帖子"
- 根据兴趣建议 3-5 个关注账号

### Claude 的裁量权
- 加载骨架设计
- 精确间距和排版
- 错误状态处理

</decisions>

<specifics>
## 具体想法

- "我喜欢 Twitter 在不打扰滚动位置的情况下显示新帖子指示器"
- 卡片应该感觉像 Linear 的问题卡片 — 干净，不杂乱

</specifics>

<deferred>
## 延迟的想法

- 帖子评论 — 阶段 5
- 收藏帖子 — 添加到待办事项

</deferred>

---

*阶段：03-post-feed*
*上下文收集时间：2025-01-20*
```

**示例 2：CLI 工具（数据库备份）**

```markdown
# 阶段 2：备份命令 - 上下文

**收集时间：** 2025-01-20
**状态：** 准备好进行规划

<domain>
## 阶段边界

将数据库备份到本地文件或 S3 的 CLI 命令。支持完整备份和增量备份。恢复命令是独立的阶段。

</domain>

<decisions>
## 实施决策

### 输出格式
- JSON 用于程序化使用，表格格式供人类使用
- 默认为表格，--json 标志用于 JSON
- 详细模式 (-v) 显示进度，默认静默

### 标志设计
- 常用选项使用短标志：-o（输出）、-v（详细）、-f（强制）
- 清晰起见使用长标志：--incremental、--compress、--encrypt
- 必需：数据库连接字符串（位置参数或 --db）

### 错误恢复
- 网络失败时重试 3 次，然后以清晰消息失败
- --no-retry 标志用于快速失败
- 部分备份在失败时删除（无损坏文件）

### Claude 的裁量权
- 精确进度条实现
- 压缩算法选择
- 临时文件处理

</decisions>

<specifics>
## 具体想法

- "我希望它感觉像 pg_dump — 数据库人员熟悉"
- 应在 CI 管道中工作（退出码、无交互式提示）

</specifics>

<deferred>
## 延迟的想法

- 定期备份 — 独立阶段
- 备份轮换/保留 — 添加到待办事项

</deferred>

---

*阶段：02-backup-command*
*上下文收集时间：2025-01-20*
```

**示例 3：组织任务（照片库）**

```markdown
# 阶段 1：照片组织 - 上下文

**收集时间：** 2025-01-20
**状态：** 准备好进行规划

<domain>
## 阶段边界

将现有照片库组织成结构化文件夹。处理重复项并应用一致的命名。标记和搜索是独立的阶段。

</domain>

<decisions>
## 实施决策

### 分组标准
- 主要按年份分组，然后按月份
- 通过时间聚类检测事件（2 小时内的照片 = 同一事件）
- 事件文件夹按日期 + 位置命名（如果有）

### 重复处理
- 保留最高分辨率版本
- 将重复项移动到 _duplicates 文件夹（不删除）
- 记录所有重复决策以供审查

### 命名约定
- 格式：YYYY-MM-DD_HH-MM-SS_原始名称.ext
- 保留原始文件名作为后缀以可搜索
- 使用递增后缀处理名称冲突

### Claude 的裁量权
- 精确聚类算法
- 如何处理没有 EXIF 数据的照片
- 文件夹表情符号使用

</decisions>

<specifics>
## 具体想法

- "我希望能够大致按拍摄时间找到照片"
- 不要删除任何东西 — 最坏情况下，移动到审查文件夹

</specifics>

<deferred>
## 延迟的想法

- 人脸检测分组 — 未来阶段
- 云同步 — 目前超出范围

</deferred>

---

*阶段：01-photo-organization*
*上下文收集时间：2025-01-20*
```

</good_examples>

<guidelines>
**此模板捕获下游代理的决策。**

输出应回答："研究者需要调查什么？规划者的哪些选择已锁定？"

**好的内容（具体决策）：**
- "基于卡片的布局，而非时间线"
- "网络失败时重试 3 次，然后失败"
- "按年份分组，然后按月份"
- "JSON 用于程序化使用，表格供人类使用"

**不好的内容（太模糊）：**
- "应该感觉现代干净"
- "良好的用户体验"
- "快速响应"
- "易于使用"

**创建后：**
- 文件位于阶段目录：`.planning/phases/XX-name/{phase}-CONTEXT.md`
- `gsd-phase-researcher` 使用决策聚焦调查
- `gsd-planner` 使用决策 + 研究创建可执行任务
- 下游代理不应再次询问用户有关已捕获决策的问题
</guidelines>
